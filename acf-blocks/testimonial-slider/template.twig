{# acf-blocks/testimonial-slider/template.twig #}
{% set slides = fields.testimonials ?? [] %}
{% set autoplay = fields.autoplay ?? false %}
{% set slider_id = 'testimonial-slider-' ~ random() %}

{% if slides %}
<div id="{{ slider_id }}" class="testimonial-slider relative overflow-hidden">
  <div class="slides flex transition-transform duration-700 ease-in-out">
    {% for item in slides %}
      <div class="slide min-w-full px-6 py-8 text-center">
        {% if item.avatar %}
          <img src="{{ item.avatar.url }}" alt="{{ item.avatar.alt }}" class="mx-auto rounded-full w-20 h-20 object-cover mb-4" />
        {% endif %}

        {% if item.name %}
          <h3 class="text-lg font-bold mb-2">{{ item.name }}</h3>
        {% endif %}

        {% if item.text %}
          <p class="text-gray-600 italic mb-3">"{{ item.text }}"</p>
        {% endif %}

        {% if item.rating %}
          <div class="text-yellow-400 mb-1">
            {% for i in 1..item.rating %}
              <span>★</span>
            {% endfor %}
            {% for i in item.rating+1..5 %}
              <span class="text-gray-300">★</span>
            {% endfor %}
          </div>
        {% endif %}
      </div>
    {% endfor %}
  </div>
</div>

{% if autoplay %}
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const slider = document.getElementById('{{ slider_id }}');
      const slides = slider.querySelector('.slides');
      const total = {{ slides|length }};
      let index = 0;

      setInterval(() => {
        index = (index + 1) % total;
        slides.style.transform = `translateX(-${index * 100}%)`;
      }, 5000);
    });
  </script>
{% endif %}
{% endif %}
